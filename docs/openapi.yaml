# Generated with protoc-gen-openapi
# https://github.com/google/gnostic/tree/master/cmd/protoc-gen-openapi

openapi: 3.0.3
info:
    title: maco
    description: maco OpenAPI3.0 Document
    version: 2d782fb9617ca168f9d191e70a6e1211e147bdfe
paths:
    /v1/call:
        post:
            tags:
                - MacoRPC
            operationId: MacoRPC_Call
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/rpc.macopb.CallRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/rpc.macopb.CallResponse'
            security:
                - bearerAuth: []
    /v1/minion/{name}:
        get:
            tags:
                - MacoRPC
            operationId: MacoRPC_GetMinion
            parameters:
                - name: name
                  in: path
                  required: true
                  schema:
                    type: string
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/rpc.macopb.GetMinionResponse'
            security:
                - bearerAuth: []
    /v1/minions:
        get:
            tags:
                - MacoRPC
            operationId: MacoRPC_ListMinions
            parameters:
                - name: stateList
                  in: query
                  schema:
                    type: array
                    items:
                        type: string
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/rpc.macopb.ListMinionsResponse'
            security:
                - bearerAuth: []
    /v1/minions/action/accept:
        post:
            tags:
                - MacoRPC
            operationId: MacoRPC_AcceptMinion
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/rpc.macopb.AcceptMinionRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/rpc.macopb.AcceptMinionResponse'
            security:
                - bearerAuth: []
    /v1/minions/action/delete:
        post:
            tags:
                - MacoRPC
            operationId: MacoRPC_DeleteMinion
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/rpc.macopb.DeleteMinionRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/rpc.macopb.DeleteMinionResponse'
            security:
                - bearerAuth: []
    /v1/minions/action/print:
        post:
            tags:
                - MacoRPC
            operationId: MacoRPC_PrintMinion
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/rpc.macopb.PrintMinionRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/rpc.macopb.PrintMinionResponse'
            security:
                - bearerAuth: []
    /v1/minions/action/reject:
        post:
            tags:
                - MacoRPC
            operationId: MacoRPC_RejectMinion
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/rpc.macopb.RejectMinionRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/rpc.macopb.RejectMinionResponse'
            security:
                - bearerAuth: []
    /v1/ping:
        get:
            tags:
                - MacoRPC
            operationId: MacoRPC_Ping
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/rpc.macopb.PingResponse'
components:
    schemas:
        rpc.macopb.AcceptMinionRequest:
            type: object
            properties:
                minions:
                    type: array
                    items:
                        type: string
                all:
                    type: boolean
                includeRejected:
                    type: boolean
                includeDenied:
                    type: boolean
        rpc.macopb.AcceptMinionResponse:
            type: object
            properties:
                minions:
                    type: array
                    items:
                        type: string
        rpc.macopb.CallRequest:
            type: object
            properties:
                request:
                    $ref: '#/components/schemas/types.CallRequest'
        rpc.macopb.CallResponse:
            type: object
            properties:
                report:
                    $ref: '#/components/schemas/types.Report'
        rpc.macopb.DeleteMinionRequest:
            type: object
            properties:
                minions:
                    type: array
                    items:
                        type: string
                all:
                    type: boolean
        rpc.macopb.DeleteMinionResponse:
            type: object
            properties:
                minions:
                    type: array
                    items:
                        type: string
        rpc.macopb.GetMinionResponse:
            type: object
            properties:
                minion:
                    $ref: '#/components/schemas/types.MinionKey'
        rpc.macopb.ListMinionsResponse:
            type: object
            properties:
                unaccepted:
                    type: array
                    items:
                        type: string
                accepted:
                    type: array
                    items:
                        type: string
                autoSign:
                    type: array
                    items:
                        type: string
                denied:
                    type: array
                    items:
                        type: string
                rejected:
                    type: array
                    items:
                        type: string
        rpc.macopb.PingResponse:
            type: object
            properties: {}
        rpc.macopb.PrintMinionRequest:
            type: object
            properties:
                minions:
                    type: array
                    items:
                        type: string
                all:
                    type: boolean
        rpc.macopb.PrintMinionResponse:
            type: object
            properties:
                minions:
                    type: array
                    items:
                        $ref: '#/components/schemas/types.MinionKey'
        rpc.macopb.RejectMinionRequest:
            type: object
            properties:
                minions:
                    type: array
                    items:
                        type: string
                all:
                    type: boolean
                includeAccepted:
                    type: boolean
                includeDenied:
                    type: boolean
        rpc.macopb.RejectMinionResponse:
            type: object
            properties:
                minions:
                    type: array
                    items:
                        type: string
        types.CallRequest:
            type: object
            properties:
                options:
                    allOf:
                        - $ref: '#/components/schemas/types.SelectionOptions'
                    description: 筛选符合的 minions
                id:
                    type: string
                    description: 请求 id，确认请求唯一值
                function:
                    type: string
                    description: '请求方法，使用.分割，确认对应模块下的方法，如: a.b.c'
                args:
                    type: array
                    items:
                        type: string
                    description: 方法参数
                pillars:
                    type: object
                    additionalProperties:
                        $ref: '#/components/schemas/types.Value'
                    description: 加密参数
                timeout:
                    type: string
                    description: 请求超时时长
        types.LogicAnd:
            type: object
            properties: {}
        types.LogicOr:
            type: object
            properties: {}
        types.Minion:
            type: object
            properties:
                name:
                    type: string
                uid:
                    type: string
                ip:
                    type: string
                hostname:
                    type: string
                tags:
                    type: object
                    additionalProperties:
                        type: string
                os:
                    type: string
                    description: operation system
                arch:
                    type: string
                    description: cpu architecture
                version:
                    type: string
                    description: the version of minion
                registryTimestamp:
                    type: string
                    description: registry time
                onlineTimestamp:
                    type: string
                    description: the timestamp of minion connects to server
                offlineTimestamp:
                    type: string
                    description: the timestamp of minion offline
            description: Minion defines the base information of maco-minion
        types.MinionKey:
            type: object
            properties:
                minion:
                    $ref: '#/components/schemas/types.Minion'
                pubKey:
                    type: string
                    format: bytes
                state:
                    type: string
        types.Report:
            type: object
            properties:
                items:
                    type: array
                    items:
                        $ref: '#/components/schemas/types.ReportItem'
                summary:
                    $ref: '#/components/schemas/types.ReportSummary'
            description: Report Minion 执行结果
        types.ReportItem:
            type: object
            properties:
                minion:
                    type: string
                startTimestamp:
                    type: string
                endTimestamp:
                    type: string
                result:
                    type: boolean
                error:
                    type: string
                data:
                    type: string
                    format: bytes
        types.ReportSummary:
            type: object
            properties:
                success:
                    type: string
                changes:
                    type: string
                failed:
                    type: string
                total:
                    type: string
        types.Selection:
            type: object
            properties:
                host:
                    type: array
                    items:
                        type: string
                    description: 使用 minions id 作为选择条件
                hostPcre:
                    type: string
                    description: 使用 minions id 的正则表达式作为选择条件
                idRange:
                    type: string
                    description: 使用 id range 作为选择条件
                hostGroups:
                    type: array
                    items:
                        type: string
                    description: 使用 hostGroup 作为选择条件
                ipCidr:
                    type: string
                    description: 使用 ip 地址作为选择条件
                grains:
                    allOf:
                        - $ref: '#/components/schemas/types.SelectionKV'
                    description: 使用 grains 作为选择条件
                grainsPcre:
                    allOf:
                        - $ref: '#/components/schemas/types.SelectionKV'
                    description: 使用 grains 正则表达式作为选择条件
                pillar:
                    allOf:
                        - $ref: '#/components/schemas/types.SelectionKV'
                    description: 使用 pillar 作为选择条件
                pillarPcre:
                    allOf:
                        - $ref: '#/components/schemas/types.SelectionKV'
                    description: 使用 pillar 正则表达式作为选择条件
                and:
                    $ref: '#/components/schemas/types.LogicAnd'
                or:
                    $ref: '#/components/schemas/types.LogicOr'
            description: Selection minions 筛选器
        types.SelectionKV:
            type: object
            properties:
                key:
                    type: string
                value:
                    type: string
        types.SelectionOptions:
            type: object
            properties:
                selections:
                    type: array
                    items:
                        $ref: '#/components/schemas/types.Selection'
        types.Value:
            type: object
            properties:
                type:
                    type: integer
                    format: enum
                data:
                    type: string
tags:
    - name: MacoRPC
